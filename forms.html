<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>EcoTrace</title>
  
  <link rel="icon" type="image/png" href="/imagens/image-removebg-preview (1).png">
  <link rel="stylesheet" href="/css/diagnostico.css">

 
  
</head>

<body>

   <div id="menu-overlay"></div>

  <!-- Menu lateral -->
  <div id="side-menu">
      <h3 id="nome-usuario">{usu√°rio}</h3>

      <div id="menu-logado" style="display:none;">
        <button id="logout-btn">Fazer Logoff</button>
        <button id="admin-btn" style="display:none;">Dashboard Admin</button>
      </div>
<br>
      <div id="menu-deslogado" style="display:none;">
        <a href="login_cadastro.html">Fazer Login</a>
      </div>

      <button id="close-menu"></button>
  </div>

  <!-- HEADER -->
  <header>
    <a id="eco" href="index.html">
      <img id="logo" src="/imagens/cin.png" alt="ecotrace">
    </a>

    <nav>
        <a id="login" href="forms.html">
          <img class="icone" src="/imagens/log.png" alt="login">
        </a>
        
        <a id="downloads" href="downloads.html">
          <img class="icone" src="/imagens/down.png" alt="downloads">
        </a>

        <a id="perfil">
          <img class="icone" src="/imagens/perfil.png" alt="perfil">
        </a>
    </nav>
  </header>

  <main>
    <div class="container">
      <!-- TELA DE INTRODU√á√ÉO -->
      <div id="intro-screen" class="intro-screen">
        <img id="intro-icon" src="/imagens/image-removebg-preview (1).png" >
        <h1 class="intro-title">Diagn√≥stico de Sustentabilidade</h1>
        <p class="intro-subtitle">
          Avalie o compromisso ambiental da sua empresa e receba um relat√≥rio personalizado 
          com recomenda√ß√µes para melhorar suas pr√°ticas sustent√°veis.
        </p>

        <div class="intro-features">
          <div class="feature">
            <h3>üìä Avalia√ß√£o Completa</h3>
            <p>10 √°reas essenciais da sustentabilidade empresarial analisadas de forma detalhada.</p>
          </div>
          <div class="feature">
            <h3>üéØ Recomenda√ß√µes Personalizadas</h3>
            <p>Receba sugest√µes espec√≠ficas baseadas nas respostas da sua empresa.</p>
          </div>
          <div class="feature">
            <h3>üìà Plano de A√ß√£o</h3>
            <p>Identifique pontos fortes e oportunidades de melhoria com m√©tricas claras.</p>
          </div>
        </div>

        <div class="intro-time">
          <p>‚è±Ô∏è Tempo estimado: 5-7 minutos</p>
        </div>

        <div class="intro-info">
          <h3>Como funciona:</h3>
          <ul style="text-align: left; max-width: 600px; margin: 20px auto; color: var(--text-light); line-height: 1.6;">
            <li>Responda 10 perguntas sobre diferentes aspectos da sustentabilidade</li>
            <li>Escolha a op√ß√£o que melhor representa a realidade da sua empresa</li>
            <li>Visualize sua pontua√ß√£o e classifica√ß√£o final</li>
            <li>Receba recomenda√ß√µes personalizadas para evoluir</li>
            <li>Seus dados s√£o processados localmente - nada √© salvo em servidores</li>
          </ul>
        </div>

        <div class="intro-buttons">
          <button class="btn btn-start" onclick="iniciarQuestionario()">
            Iniciar Diagn√≥stico
          </button>
          <button class="btn btn-cancel" onclick="voltarParaHome()">
            Voltar para Home
          </button>
        </div>
      </div>

      <button onclick="gerarPDF()" 
        style="
            margin-top: 20px; 
            padding: 10px 20px; 
            background: #00ffa7; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px;">
    üìÑ Baixar Diagn√≥stico em PDF
</button>

      <!-- FORMUL√ÅRIO (inicialmente oculto) -->
      <div id="form-container" class="hidden">
        <div class="progress-text">Progresso: <span id="progress-percent">0%</span></div>
        <div class="progress-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>

        <form id="formulario" novalidate>
          <!-- PERGUNTA 1 -->
          <fieldset class="active">
            <legend>1. N√≠vel de Prioridade</legend>
            <div class="question">
              <p>O qu√£o voltada √† Sustentabilidade sua empresa √©?</p>
              <div class="options">
                <div class="option">
                  <input type="radio" id="sustentabilidade-0" name="sustentabilidade" value="0" required>
                  <label for="sustentabilidade-0">0 - N√£o √© voltada</label>
                </div>
                <div class="option">
                  <input type="radio" id="sustentabilidade-1" name="sustentabilidade" value="1">
                  <label for="sustentabilidade-1">1 - Pequeno foco</label>
                </div>
                <div class="option">
                  <input type="radio" id="sustentabilidade-2" name="sustentabilidade" value="2">
                  <label for="sustentabilidade-2">2 - Procedimento padr√£o</label>
                </div>
                <div class="option">
                  <input type="radio" id="sustentabilidade-3" name="sustentabilidade" value="3">
                  <label for="sustentabilidade-3">3 - Prioriza</label>
                </div>
                <div class="option">
                  <input type="radio" id="sustentabilidade-4" name="sustentabilidade" value="4">
                  <label for="sustentabilidade-4">4 - Forte pilar</label>
                </div>
                <div class="option">
                  <input type="radio" id="sustentabilidade-5" name="sustentabilidade" value="5">
                  <label for="sustentabilidade-5">5 - Totalmente voltada</label>
                </div>
              </div>
            </div>
            <div class="navigation">
              <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
              <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
            </div>
          </fieldset>

          <!-- PERGUNTA 2 -->
          <fieldset>
            <legend>2. Energia</legend>
            <div class="question">
              <p>Qual √© a principal fonte de energia da sua Empresa?</p>
              <div class="options">
                <div class="option">
                  <input type="radio" id="energia-0" name="energia" value="0" required>
                  <label for="energia-0">0 - Fontes N√£o Renov√°veis</label>
                </div>
                <div class="option">
                  <input type="radio" id="energia-1" name="energia" value="1">
                  <label for="energia-1">1 - Majoritariamente N√£o Renov√°vel</label>
                </div>
                <div class="option">
                  <input type="radio" id="energia-2" name="energia" value="2">
                  <label for="energia-2">2 - H√≠brido</label>
                </div>
                <div class="option">
                  <input type="radio" id="energia-3" name="energia" value="3">
                  <label for="energia-3">3 - Majoritariamente Renov√°vel</label>
                </div>
                <div class="option">
                  <input type="radio" id="energia-4" name="energia" value="4">
                  <label for="energia-4">4 - Fontes Renov√°veis</label>
                </div>
                <div class="option">
                  <input type="radio" id="energia-5" name="energia" value="5">
                  <label for="energia-5">5 - N√£o definido</label>
                </div>
              </div>
            </div>
            <div class="navigation">
              <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
              <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
            </div>
          </fieldset>

          <!-- ... (as outras 8 perguntas permanecem iguais) ... -->
          <!-- PERGUNTA 3 -->
          <fieldset>
            <legend>3. √Ågua</legend>
            <div class="question">
              <p>H√° monitoramento regular do consumo de √°gua na produ√ß√£o?</p>
              <div class="options">
                <div class="option">
                  <input type="radio" id="agua-0" name="agua" value="0" required>
                  <label for="agua-0">0 - N√£o h√° monitoramento</label>
                </div>
                <div class="option">
                  <input type="radio" id="agua-1" name="agua" value="1">
                  <label for="agua-1">1 - Fraco</label>
                </div>
                <div class="option">
                  <input type="radio" id="agua-2" name="agua" value="2">
                  <label for="agua-2">2 - Regular</label>
                </div>
                <div class="option">
                  <input type="radio" id="agua-3" name="agua" value="3">
                  <label for="agua-3">3 - Forte</label>
                </div>
                <div class="option">
                  <input type="radio" id="agua-4" name="agua" value="4">
                  <label for="agua-4">4 - Prioridade</label>
                </div>
                <div class="option">
                  <input type="radio" id="agua-5" name="agua" value="5">
                  <label for="agua-5">5 - Avan√ßado</label>
                </div>
              </div>
            </div>
            <div class="navigation">
              <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
              <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
            </div>
          </fieldset>

          
           <!-- PERGUNTA 4 -->
        <fieldset>
          <legend>4. Res√≠duos</legend>
          <div class="question">
            <p>Como √© feito o gerenciamento dos res√≠duos gerados pela produ√ß√£o?</p>
            <div class="options">
              <div class="option">
                <input type="radio" id="residuos-0" name="residuos" value="0" required>
                <label for="residuos-0">0 - N√£o h√° gest√£o</label>
              </div>
              <div class="option">
                <input type="radio" id="residuos-1" name="residuos" value="1">
                <label for="residuos-1">1 - Descarte b√°sico</label>
              </div>
              <div class="option">
                <input type="radio" id="residuos-2" name="residuos" value="2">
                <label for="residuos-2">2 - Reciclagem parcial</label>
              </div>
              <div class="option">
                <input type="radio" id="residuos-3" name="residuos" value="3">
                <label for="residuos-3">3 - Plano estruturado</label>
              </div>
              <div class="option">
                <input type="radio" id="residuos-4" name="residuos" value="4">
                <label for="residuos-4">4 - Reuso e otimiza√ß√£o</label>
              </div>
              <div class="option">
                <input type="radio" id="residuos-5" name="residuos" value="5">
                <label for="residuos-5">5 - Sistema completo e monitorado</label>
              </div>
            </div>
          </div>
          <div class="navigation">
            <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
            <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
          </div>
        </fieldset>

        <!-- PERGUNTA 5 -->
        <fieldset>
          <legend>5. Emiss√µes Atmosf√©ricas</legend>
          <div class="question">
            <p>A empresa controla e reduz as emiss√µes de gases poluentes?</p>
            <div class="options">
              <div class="option">
                <input type="radio" id="emissoes-0" name="emissoes" value="0" required>
                <label for="emissoes-0">0 - N√£o h√° controle</label>
              </div>
              <div class="option">
                <input type="radio" id="emissoes-1" name="emissoes" value="1">
                <label for="emissoes-1">1 - Monitoramento espor√°dico</label>
              </div>
              <div class="option">
                <input type="radio" id="emissoes-2" name="emissoes" value="2">
                <label for="emissoes-2">2 - Controle b√°sico</label>
              </div>
              <div class="option">
                <input type="radio" id="emissoes-3" name="emissoes" value="3">
                <label for="emissoes-3">3 - Sistema de filtragem</label>
              </div>
              <div class="option">
                <input type="radio" id="emissoes-4" name="emissoes" value="4">
                <label for="emissoes-4">4 - Redu√ß√£o ativa de poluentes</label>
              </div>
              <div class="option">
                <input type="radio" id="emissoes-5" name="emissoes" value="5">
                <label for="emissoes-5">5 - Gest√£o avan√ßada e certificada</label>
              </div>
            </div>
          </div>
          <div class="navigation">
            <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
            <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
          </div>
        </fieldset>

        <!-- PERGUNTA 6 -->
        <fieldset>
          <legend>6. Cadeia de Fornecimento</legend>
          <div class="question">
            <p>Como sua empresa avalia a sustentabilidade dos fornecedores?</p>
            <div class="options">
              <div class="option">
                <input type="radio" id="fornecedores-0" name="fornecedores" value="0" required>
                <label for="fornecedores-0">0 - N√£o avalia</label>
              </div>
              <div class="option">
                <input type="radio" id="fornecedores-1" name="fornecedores" value="1">
                <label for="fornecedores-1">1 - Avalia√ß√£o informal</label>
              </div>
              <div class="option">
                <input type="radio" id="fornecedores-2" name="fornecedores" value="2">
                <label for="fornecedores-2">2 - Crit√©rios b√°sicos</label>
              </div>
              <div class="option">
                <input type="radio" id="fornecedores-3" name="fornecedores" value="3">
                <label for="fornecedores-3">3 - Sistema estruturado</label>
              </div>
              <div class="option">
                <input type="radio" id="fornecedores-4" name="fornecedores" value="4">
                <label for="fornecedores-4">4 - Auditoria regular</label>
              </div>
              <div class="option">
                <input type="radio" id="fornecedores-5" name="fornecedores" value="5">
                <label for="fornecedores-5">5 - Cadeia totalmente sustent√°vel</label>
              </div>
            </div>
          </div>
          <div class="navigation">
            <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
            <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
          </div>
        </fieldset>

        <!-- PERGUNTA 7 -->
        <fieldset>
          <legend>7. Inova√ß√£o e Tecnologia</legend>
          <div class="question">
            <p>A empresa investe em tecnologias sustent√°veis?</p>
            <div class="options">
              <div class="option">
                <input type="radio" id="inovacao-0" name="inovacao" value="0" required>
                <label for="inovacao-0">0 - N√£o investe</label>
              </div>
              <div class="option">
                <input type="radio" id="inovacao-1" name="inovacao" value="1">
                <label for="inovacao-1">1 - Investimentos m√≠nimos</label>
              </div>
              <div class="option">
                <input type="radio" id="inovacao-2" name="inovacao" value="2">
                <label for="inovacao-2">2 - Algumas iniciativas</label>
              </div>
              <div class="option">
                <input type="radio" id="inovacao-3" name="inovacao" value="3">
                <label for="inovacao-3">3 - Programa estruturado</label>
              </div>
              <div class="option">
                <input type="radio" id="inovacao-4" name="inovacao" value="4">
                <label for="inovacao-4">4 - Inova√ß√£o cont√≠nua</label>
              </div>
              <div class="option">
                <input type="radio" id="inovacao-5" name="inovacao" value="5">
                <label for="inovacao-5">5 - L√≠der em tecnologia verde</label>
              </div>
            </div>
          </div>
          <div class="navigation">
            <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
            <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
          </div>
        </fieldset>

        <!-- PERGUNTA 8 -->
        <fieldset>
          <legend>8. Educa√ß√£o e Conscientiza√ß√£o</legend>
          <div class="question">
            <p>Como a empresa promove a conscientiza√ß√£o ambiental entre colaboradores?</p>
            <div class="options">
              <div class="option">
                <input type="radio" id="educacao-0" name="educacao" value="0" required>
                <label for="educacao-0">0 - N√£o promove</label>
              </div>
              <div class="option">
                <input type="radio" id="educacao-1" name="educacao" value="1">
                <label for="educacao-1">1 - Informa√ß√µes b√°sicas</label>
              </div>
              <div class="option">
                <input type="radio" id="educacao-2" name="educacao" value="2">
                <label for="educacao-2">2 - Treinamentos eventuais</label>
              </div>
              <div class="option">
                <input type="radio" id="educacao-3" name="educacao" value="3">
                <label for="educacao-3">3 - Programa cont√≠nuo</label>
              </div>
              <div class="option">
                <input type="radio" id="educacao-4" name="educacao" value="4">
                <label for="educacao-4">4 - Cultura organizacional</label>
              </div>
              <div class="option">
                <input type="radio" id="educacao-5" name="educacao" value="5">
                <label for="educacao-5">5 - Lideran√ßa exemplar</label>
              </div>
            </div>
          </div>
          <div class="navigation">
            <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
            <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
          </div>
        </fieldset>

        <!-- PERGUNTA 9 -->
        <fieldset>
          <legend>9. Certifica√ß√µes e Reconhecimento</legend>
          <div class="question">
            <p>A empresa possui certifica√ß√µes ambientais?</p>
            <div class="options">
              <div class="option">
                <input type="radio" id="certificacoes-0" name="certificacoes" value="0" required>
                <label for="certificacoes-0">0 - Nenhuma certifica√ß√£o</label>
              </div>
              <div class="option">
                <input type="radio" id="certificacoes-1" name="certificacoes" value="1">
                <label for="certificacoes-1">1 - Em processo de obten√ß√£o</label>
              </div>
              <div class="option">
                <input type="radio" id="certificacoes-2" name="certificacoes" value="2">
                <label for="certificacoes-2">2 - 1-2 certifica√ß√µes b√°sicas</label>
              </div>
              <div class="option">
                <input type="radio" id="certificacoes-3" name="certificacoes" value="3">
                <label for="certificacoes-3">3 - Certifica√ß√µes relevantes</label>
              </div>
              <div class="option">
                <input type="radio" id="certificacoes-4" name="certificacoes" value="4">
                <label for="certificacoes-4">4 - M√∫ltiplas certifica√ß√µes</label>
              </div>
              <div class="option">
                <input type="radio" id="certificacoes-5" name="certificacoes" value="5">
                <label for="certificacoes-5">5 - Reconhecimento internacional</label>
              </div>
            </div>
          </div>
          <div class="navigation">
            <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
            <button class="btn btn-next" type="button" onclick="nextStep()">Pr√≥ximo</button>
          </div>
        </fieldset>

        <!-- PERGUNTA 10 -->
        <fieldset>
          <legend>10. Transpar√™ncia e Relat√≥rios</legend>
          <div class="question">
            <p>A empresa publica relat√≥rios de sustentabilidade?</p>
            <div class="options">
              <div class="option">
                <input type="radio" id="relatorios-0" name="relatorios" value="0" required>
                <label for="relatorios-0">0 - N√£o publica</label>
              </div>
              <div class="option">
                <input type="radio" id="relatorios-1" name="relatorios" value="1">
                <label for="relatorios-1">1 - Informa√ß√µes b√°sicas no site</label>
              </div>
              <div class="option">
                <input type="radio" id="relatorios-2" name="relatorios" value="2">
                <label for="relatorios-2">2 - Relat√≥rio anual simples</label>
              </div>
              <div class="option">
                <input type="radio" id="relatorios-3" name="relatorios" value="3">
                <label for="relatorios-3">3 - Relat√≥rio detalhado</label>
              </div>
              <div class="option">
                <input type="radio" id="relatorios-4" name="relatorios" value="4">
                <label for="relatorios-4">4 - Padr√µes internacionais (GRI)</label>
              </div>
              <div class="option">
                <input type="radio" id="relatorios-5" name="relatorios" value="5">
                <label for="relatorios-5">5 - Lideran√ßa em transpar√™ncia</label>
              </div>
            </div>
          </div>
          <div class="navigation">
            <button class="btn btn-prev" type="button" onclick="prevStep()">Anterior</button>
            <button class="btn btn-submit" type="button" onclick="calcularResultado()">Ver Resultado</button>
          </div>
        </fieldset>

        </form>

        <!-- RESULTADO -->
        <div id="resultado">
          <div class="score-circle" id="score-circle">0</div>
          <h2 class="result-title" id="result-title">Seu Resultado</h2>
          <p class="result-description" id="result-description"></p>
          <div class="recommendations" id="recommendations"></div>
          <button class="btn btn-restart" onclick="reiniciarQuestionario()">Fazer Novamente</button>
          <button onclick="gerarPDF()" 
        style="
            margin-top: 20px; 
            padding: 10px 20px; 
            background: #00ffa7; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px;">
    üìÑ Baixar Diagn√≥stico em PDF
</button>
        </div>
      </div>

    </div>
  </main>

  <footer>
    ¬© 2025 EcoTrace ‚Äî Tecnologia e Sustentabilidade
  </footer>

  <script src="/js/barra.js"></script>

  <!-- SCRIPT DO MENU LATERAL + FIREBASE -->
  <script type="module" src="/js/dia1.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Biblioteca para gerar PDF -->
<script type="module">
// ======================================================
// üî• CARREGAR DIAGN√ìSTICO DIRETAMENTE DO FIRESTORE
// ======================================================
async function carregarDiagnostico() {
    const usuario = await verificarUsuarioLogado();
    if (!usuario) return null;

    const { 
        getFirestore, collection, query, where, orderBy, limit, getDocs 
    } = await import("https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js");

    const db = getFirestore();

    const q = query(
        collection(db, "diagnosticos"),
        where("usuarioId", "==", usuario.uid),
        orderBy("data", "desc"),
        limit(1)
    );

    const snap = await getDocs(q);

    if (snap.empty) {
        alert("Nenhum diagn√≥stico encontrado.");
        return null;
    }

    const diag = snap.docs[0].data();
    console.log("üî• Diagn√≥stico carregado:", diag);
    return diag;
}

// ======================================================
// üî• GERAR PDF DO DIAGN√ìSTICO (AGORA SEM CACHE ANTIGO)
// ======================================================
async function gerarPDF() {
    console.log("üìÑ Fun√ß√£o gerarPDF() chamada!");

    // Sempre buscar o diagn√≥stico mais recente
    const diag = await carregarDiagnostico(); 
    if (!diag) {
        alert("Erro: nenhum diagn√≥stico encontrado.");
        return;
    }

    // Dados do usu√°rio
    const usuario = await verificarUsuarioLogado();
    const { getFirestore, doc, getDoc } = await import("https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js");
    const db = getFirestore();

    const userRef = doc(db, "usuarios", usuario.uid);
    const userSnap = await getDoc(userRef);

    const nome = userSnap.exists() ? userSnap.data().nome : usuario.displayName || "Usu√°rio";
    const empresa = userSnap.exists() ? userSnap.data().empresa : usuario.email;

   // ======================================================
// üìÑ CRIA√á√ÉO DO CONTE√öDO PARA O PDF
// ======================================================
const div = document.createElement("div");
div.style.padding = "25px";
div.style.fontFamily = "Arial, sans-serif";
div.style.lineHeight = "1.4";
div.style.fontSize = "13.5px";
div.style.maxWidth = "800px";
div.style.margin = "0 auto";

div.innerHTML = `
    <h1 style="
        color:#009f6b;
        text-align:center;
        margin-bottom: 5px;
    ">
        Relat√≥rio EcoTrace
    </h1>
    <hr style="border:0; border-bottom:1px solid #ccc; margin: 10px 0 20px 0;">

    <div style="margin-bottom:20px;">
        <p><strong>Nome:</strong> ${nome}</p>
        <p><strong>Empresa:</strong> ${empresa}</p>
        <p><strong>Data:</strong> ${new Date(diag.data.seconds * 1000).toLocaleString("pt-BR")}</p>
    </div>

    <h2 style="color:#009f6b; margin-bottom:5px;">Pontua√ß√£o Geral</h2>
    <p style="font-size:15px;"><strong>${diag.pontuacao}% ‚Äì ${diag.categoria}</strong></p>

    <h2 style="color:#009f6b; margin-top:20px;">Descri√ß√£o do Resultado</h2>
    <p>${gerarDescricao(diag.pontuacao)}</p>

    <h2 style="color:#009f6b; margin-top:20px;">Recomenda√ß√µes</h2>
    <ul style="margin-left:15px;">
        ${gerarRecs(diag.pontuacao)
            .map(r => `<li style="margin-bottom:5px;">${r}</li>`)
            .join("")}
    </ul>

    <h2 style="color:#009f6b; margin-top:20px;">Respostas do Question√°rio</h2>
    <pre style="
        background:#f5f5f5;
        padding:10px;
        border-radius:6px;
        white-space:pre-wrap;
        word-break:break-word;
        font-size:12px;
    ">
${JSON.stringify(diag.respostas, null, 2)}
    </pre>
`;

// Adiciona ao HTML (necess√°rio para html2pdf)
document.body.appendChild(div);

// ======================================================
// üñ®Ô∏è CONFIGURA√á√ïES DO PDF
// ======================================================
const opt = {
    margin:       10,
    filename:     `EcoTrace-Diagnostico.pdf`,
    image:        { type: "jpeg", quality: 0.98 },
    html2canvas:  { scale: 2 },
    jsPDF:        { unit: "mm", format: "a4", orientation: "portrait" }
};

// Gera o PDF
await html2pdf().set(opt).from(div).save();

// Remove o conte√∫do ap√≥s gerar
div.remove();
}

// ======================================================
// üìå DESCRI√á√ÉO
// ======================================================
function gerarDescricao(score) {
    if (score >= 90) return "Sua empresa demonstra excel√™ncia em pr√°ticas sustent√°veis.";
    if (score >= 75) return "Sua empresa apresenta forte responsabilidade ambiental.";
    if (score >= 60) return "Sua empresa est√° evoluindo na jornada sustent√°vel.";
    if (score >= 40) return "Sua empresa iniciou a jornada, mas precisa de melhorias.";
    return "A empresa precisa de aten√ß√£o imediata em sustentabilidade.";
}

// ======================================================
// üìå RECOMENDA√á√ïES
// ======================================================
function gerarRecs(score) {
    if (score >= 90) return ["Participe de f√≥runs internacionais", "Busque certifica√ß√µes avan√ßadas", "Mentore outras empresas"];
    if (score >= 75) return ["Defina metas carbono zero", "Amplie certifica√ß√µes", "Parcerias com ONGs"];
    if (score >= 60) return ["Crie comit√™ ESG", "Defina metas mensur√°veis", "Treinamento interno"];
    if (score >= 40) return ["Auditorias ambientais", "Plano de a√ß√£o inicial", "Projetos sustent√°veis simples"];
    return ["Consultoria urgente", "Pol√≠ticas ambientais b√°sicas", "Treinamento de emerg√™ncia"];
}

// ======================================================
// üî• Torna a fun√ß√£o global para o bot√£o funcionar
// ======================================================
window.gerarPDF = gerarPDF;
</script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // ==== SUA CONFIG DO FIREBASE ====
    const firebaseConfig = {
        apiKey: "AIzaSyAe7mU1MyCwrBmJlm89cKM-WHONzeqyU3w",
        authDomain: "projeto-ecotrace.firebaseapp.com",
        projectId: "projeto-ecotrace",
        storageBucket: "projeto-ecotrace.firebasestorage.app",
        messagingSenderId: "528782336744",
        appId: "1:528782336744:web:1f4b1fa4807543ff225f5d",
        measurementId: "G-RTWLGJD188"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const sideMenu = document.getElementById("side-menu");
    const overlay = document.getElementById("menu-overlay");
    const perfilBtn = document.getElementById("perfil");
    const closeBtn = document.getElementById("close-menu");

    const logadoDiv = document.getElementById("menu-logado");
    const deslogadoDiv = document.getElementById("menu-deslogado");
    const logoutBtn = document.getElementById("logout-btn");
    const adminBtn = document.getElementById("admin-btn");
    const nomeUsuarioH3 = document.getElementById("nome-usuario");

    let notificou = false;

    function mostrarNotificacao(texto) {
        const notif = document.createElement("div");
        notif.classList.add("notificacao");
        notif.textContent = texto;
        document.body.appendChild(notif);
        setTimeout(() => notif.classList.add("show"), 100);
        setTimeout(() => {
            notif.classList.remove("show");
            setTimeout(() => notif.remove(), 500);
        }, 3500);
    }

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            logadoDiv.style.display = "flex";
            deslogadoDiv.style.display = "none";

            const nome = user.displayName || user.email.split("@")[0];
            nomeUsuarioH3.textContent = nome;

            // üîπ Verifica se o usu√°rio √© admin
            const userDoc = await getDoc(doc(db, "usuarios", user.uid));
            const role = userDoc.exists() ? userDoc.data().role : "user";

            if (role === "admin" && adminBtn) {
                adminBtn.style.display = "block";
                adminBtn.onclick = () => window.location.href = "dashboard.html";
            } else if (adminBtn) {
                adminBtn.style.display = "none";
            }

            if (!notificou) {
                mostrarNotificacao(`Bem-vindo de volta, ${nome}!`);
                notificou = true;
            }

        } else {
            logadoDiv.style.display = "none";
            deslogadoDiv.style.display = "flex";
            nomeUsuarioH3.textContent = "Visitante";
            if (adminBtn) adminBtn.style.display = "none";
        }
    });

    // üî• Logout
    if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });
    }

    // ===== Abertura/fechamento do menu =====
    perfilBtn.addEventListener("click", () => {
        sideMenu.classList.add("open");
        overlay.classList.add("active");
    });

    closeBtn.addEventListener("click", () => {
        sideMenu.classList.remove("open");
        overlay.classList.remove("active");
    });

    overlay.addEventListener("click", () => {
        sideMenu.classList.remove("open");
        overlay.classList.remove("active");
    });

  </script>

</body>
</html>