<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>EcoTrace</title>
  
  <link rel="icon" type="image/png" href="../imagens/image-removebg-preview (1).png">
  <link rel="stylesheet" href="/css/download.css">
</head>

<body>
  <!-- Overlay -->
  <div id="menu-overlay"></div>

  <!-- Menu lateral -->
  <div id="side-menu">
    <h3 id="nome-usuario">{usu√°rio}</h3>

    <div id="menu-logado" style="display:none;">
      <button id="logout-btn">Fazer Logoff</button>
      <button id="admin-btn" style="display:none;">Dashboard Admin</button>
    </div>

    <div id="menu-deslogado" style="display:none;">
      <a href="login_cadastro.html">Fazer Login</a>
    </div>

    <button id="close-menu">E </button>
  </div>

  <!-- HEADER -->
  <header>
    <a id="eco" href="index.html">
      <img id="logo" src="/imagens/cin.png" alt="ecotrace">
    </a>

    <nav>
      <a id="login" href="forms.html">
        <img class="icone" src="/imagens/log.png" alt="login">
      </a>
      
      <a id="downloads" href="downloads.html">
        <img class="icone" src="/imagens/down.png" alt="downloads">
      </a>

      <a id="perfil">
        <img class="icone" src="/imagens/perfil.png" alt="perfil">
      </a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="downloads-hero">
    <h1>BAIXE O ECOTRACE AGORA</h1>
    <p>Tenha acesso √† nossa plataforma completa para rastreamento de impacto ambiental e sustentabilidade</p>
  </section>

  <!-- DOWNLOADS -->
  <div class="downloads-container">
    <!-- Card Desktop -->
    <div class="download-card">
      <div class="download-icon">
        <svg viewBox="0 0 24 24">
          <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
        </svg>
      </div>
      <h3>Seu Plano</h3>
      <p>Vers√£o completa para Windows com todas as funcionalidades de an√°lise e relat√≥rios de sustentabilidade.</p>
      <a href="downloads/EcoTrace_Setup_2.1.4.exe" class="download-btn pulse-animation">
        BAIXE SEU PDF AQUI!
      </a>
    </div>

    <!-- Card Mobile -->
    <div class="download-card">
      <div class="download-icon">
        <svg viewBox="0 0 24 24">
          <path d="M18.71,19.5C17.88,20.74,17,21.95,15.66,21.97C14.32,22,13.89,21.18,12.37,21.18C10.84,21.18,10.37,21.95,9.1,22C7.79,22.05,6.8,20.68,5.96,19.47C4.25,17,2.94,12.45,4.7,9.39C5.57,7.87,7.13,6.91,8.82,6.88C10.1,6.86,11.32,7.75,12.11,7.75C12.89,7.75,14.37,6.68,15.92,6.84C16.57,6.87,18.39,7.1,19.56,8.82C19.47,8.88,17.39,10.1,17.41,12.63C17.44,15.65,20.06,16.66,20.09,16.67C20.06,16.74,19.67,18.11,18.71,19.5ZM13,3.5C13.73,2.67,14.94,2.04,15.94,2C16.07,3.17,15.6,4.35,14.9,5.19C14.21,6.04,13.07,6.7,11.95,6.61C11.8,5.46,12.36,4.26,13,3.5Z"/>
        </svg>
      </div>
      <h3>Game</h3>
      <p>Aplicativo para Android e iOS com funcionalidades de escaneamento e acompanhamento em tempo real.</p>
      <a href="downloads/EcoTrace_Mobile_1.5.2.zip" class="download-btn pulse-animation">
        DOWNLOAD AQUI!
      </a>
    </div>

    <!-- Card Documenta√ß√£o -->
    <div class="download-card">
      <div class="download-icon">
        <svg viewBox="0 0 24 24">
          <path d="M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M5,9.17V15.33L12,19L19,15.33V9.17L12,5.83L5,9.17Z"/>
        </svg>
      </div>
      <h3>Documenta√ß√£o</h3>
      <p>Manual completo do usu√°rio, guias de instala√ß√£o e documenta√ß√£o t√©cnica da plataforma EcoTrace.</p>
      <a href="downloads/EcoTrace_Documentation_2.1.pdf" class="download-btn pulse-animation">
        BAIXE O MANUAL AQUI!
      </a>
    </div>

  </div>

  <!-- FOOTER -->
  <footer>
    ¬© 2025 EcoTrace ‚Äî Tecnologia e Sustentabilidade
  </footer>

  <!-- SCRIPT DO MENU LATERAL + FIREBASE -->
   <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // ==== SUA CONFIG DO FIREBASE ====
    const firebaseConfig = {
        apiKey: "AIzaSyAe7mU1MyCwrBmJlm89cKM-WHONzeqyU3w",
        authDomain: "projeto-ecotrace.firebaseapp.com",
        projectId: "projeto-ecotrace",
        storageBucket: "projeto-ecotrace.firebasestorage.app",
        messagingSenderId: "528782336744",
        appId: "1:528782336744:web:1f4b1fa4807543ff225f5d",
        measurementId: "G-RTWLGJD188"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const sideMenu = document.getElementById("side-menu");
    const overlay = document.getElementById("menu-overlay");
    const perfilBtn = document.getElementById("perfil");
    const closeBtn = document.getElementById("close-menu");

    const logadoDiv = document.getElementById("menu-logado");
    const deslogadoDiv = document.getElementById("menu-deslogado");
    const logoutBtn = document.getElementById("logout-btn");
    const adminBtn = document.getElementById("admin-btn");
    const nomeUsuarioH3 = document.getElementById("nome-usuario");

    let notificou = false;

    function mostrarNotificacao(texto) {
        const notif = document.createElement("div");
        notif.classList.add("notificacao");
        notif.textContent = texto;
        document.body.appendChild(notif);
        setTimeout(() => notif.classList.add("show"), 100);
        setTimeout(() => {
            notif.classList.remove("show");
            setTimeout(() => notif.remove(), 500);
        }, 3500);
    }

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            logadoDiv.style.display = "flex";
            deslogadoDiv.style.display = "none";

            const nome = user.displayName || user.email.split("@")[0];
            nomeUsuarioH3.textContent = nome;

            // üîπ Verifica se o usu√°rio √© admin
            const userDoc = await getDoc(doc(db, "usuarios", user.uid));
            const role = userDoc.exists() ? userDoc.data().role : "user";

            if (role === "admin" && adminBtn) {
                adminBtn.style.display = "block";
                adminBtn.onclick = () => window.location.href = "dashboard.html";
            } else if (adminBtn) {
                adminBtn.style.display = "none";
            }

            if (!notificou) {
                mostrarNotificacao(`Bem-vindo de volta, ${nome}!`);
                notificou = true;
            }

        } else {
            logadoDiv.style.display = "none";
            deslogadoDiv.style.display = "flex";
            nomeUsuarioH3.textContent = "Visitante";
            if (adminBtn) adminBtn.style.display = "none";
        }
    });

    // üî• Logout
    if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });
    }

    // ===== Abertura/fechamento do menu =====
    perfilBtn.addEventListener("click", () => {
        sideMenu.classList.add("open");
        overlay.classList.add("active");
    });

    closeBtn.addEventListener("click", () => {
        sideMenu.classList.remove("open");
        overlay.classList.remove("active");
    });

    overlay.addEventListener("click", () => {
        sideMenu.classList.remove("open");
        overlay.classList.remove("active");
    });

  </script>
</body>
</html>
